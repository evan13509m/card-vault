responses.
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gridiron Vault Pro</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.0.0/tesseract.min.js"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  color: #fff;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  min-height: 100vh;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

header {
  background: rgba(30, 41, 59, 0.9);
  backdrop-filter: blur(10px);
  padding: 20px;
  border-radius: 15px;
  margin-bottom: 30px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

h1 {
  font-size: 2.5rem;
  background: linear-gradient(90deg, #38bdf8, #22d3ee);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 10px;
}

.tagline {
  color: #94a3b8;
  font-size: 0.95rem;
}

nav {
  display: flex;
  gap: 10px;
  background: rgba(30, 41, 59, 0.8);
  padding: 15px;
  border-radius: 12px;
  margin-bottom: 25px;
  flex-wrap: wrap;
}

nav button {
  flex: 1;
  min-width: 120px;
  padding: 12px 20px;
  background: #1e293b;
  color: #38bdf8;
  border: 2px solid #334155;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.95rem;
  transition: all 0.3s ease;
}

nav button:hover {
  background: #334155;
  border-color: #38bdf8;
  transform: translateY(-2px);
}

nav button.active {
  background: #38bdf8;
  color: #0f172a;
  border-color: #38bdf8;
}

.section {
  display: none;
}

.section.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.scan-container {
  background: rgba(30, 41, 59, 0.8);
  padding: 30px;
  border-radius: 15px;
  text-align: center;
}

.file-input-wrapper {
  position: relative;
  display: inline-block;
  margin: 20px 0;
}

.file-input-label {
  display: inline-block;
  padding: 15px 40px;
  background: linear-gradient(135deg, #38bdf8, #22d3ee);
  color: #0f172a;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  font-size: 1.1rem;
  transition: all 0.3s ease;
}

.file-input-label:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(56, 189, 248, 0.3);
}

input[type="file"] {
  display: none;
}

.scan-status {
  margin-top: 15px;
  font-size: 1.1rem;
  color: #22d3ee;
  min-height: 25px;
}

.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(56, 189, 248, 0.3);
  border-top-color: #38bdf8;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-left: 10px;
  vertical-align: middle;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.stats-bar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 25px;
}

.stat-card {
  background: rgba(30, 41, 59, 0.8);
  padding: 20px;
  border-radius: 12px;
  border: 2px solid #334155;
}

.stat-label {
  color: #94a3b8;
  font-size: 0.85rem;
  margin-bottom: 8px;
}

.stat-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: #38bdf8;
}

.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
}

.card {
  background: linear-gradient(135deg, #1e293b, #334155);
  padding: 20px;
  border-radius: 12px;
  border: 2px solid #334155;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.card:hover {
  transform: translateY(-5px);
  border-color: #38bdf8;
  box-shadow: 0 10px 30px rgba(56, 189, 248, 0.2);
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: linear-gradient(90deg, #38bdf8, #22d3ee);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 15px;
}

.psa-badge {
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: #fff;
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 0.85rem;
  box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);
}

.psa-badge.grade-10 { background: linear-gradient(135deg, #10b981, #059669); }
.psa-badge.grade-9 { background: linear-gradient(135deg, #3b82f6, #2563eb); }
.psa-badge.grade-8 { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }

.player-name {
  font-size: 1.3rem;
  font-weight: 700;
  margin-bottom: 8px;
  color: #fff;
}

.card-details {
  color: #94a3b8;
  font-size: 0.9rem;
  margin-bottom: 15px;
}

.card-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 15px;
  border-top: 1px solid #334155;
}

.card-value {
  font-size: 1.4rem;
  font-weight: 700;
  color: #22d3ee;
}

.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

.btn-primary {
  background: linear-gradient(135deg, #38bdf8, #22d3ee);
  color: #0f172a;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(56, 189, 248, 0.4);
}

.btn-danger {
  background: #ef4444;
  color: white;
}

.btn-danger:hover {
  background: #dc2626;
}

.btn-success {
  background: #10b981;
  color: white;
}

.btn-success:hover {
  background: #059669;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #64748b;
}

.empty-state-icon {
  font-size: 4rem;
  margin-bottom: 20px;
  opacity: 0.5;
}

.trade-section {
  background: rgba(30, 41, 59, 0.8);
  padding: 25px;
  border-radius: 12px;
  margin-bottom: 25px;
}

.trade-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 2px solid #334155;
}

.trade-participant {
  font-size: 1.2rem;
  font-weight: 600;
  color: #38bdf8;
}

.trade-arrow {
  font-size: 1.5rem;
  color: #22d3ee;
}

.trade-request {
  background: rgba(16, 185, 129, 0.1);
  border: 2px solid #10b981;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 15px;
}

.trade-info {
  margin-bottom: 15px;
  line-height: 1.6;
}

.add-card-form {
  background: rgba(30, 41, 59, 0.8);
  padding: 30px;
  border-radius: 15px;
  max-width: 600px;
  margin: 0 auto;
}

.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  color: #94a3b8;
  font-weight: 600;
}

.form-input, .form-select {
  width: 100%;
  padding: 12px;
  background: #1e293b;
  border: 2px solid #334155;
  border-radius: 8px;
  color: white;
  font-size: 1rem;
}

.form-input:focus, .form-select:focus {
  outline: none;
  border-color: #38bdf8;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

@media (max-width: 768px) {
  .form-row {
    grid-template-columns: 1fr;
  }
  
  h1 {
    font-size: 2rem;
  }
  
  .cards-grid {
    grid-template-columns: 1fr;
  }
}

.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #10b981;
  color: white;
  padding: 15px 25px;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
  animation: slideIn 0.3s ease;
  z-index: 1000;
}

@keyframes slideIn {
  from { transform: translateX(400px); }
  to { transform: translateX(0); }
}
</style>
</head>

<body>

<div class="container">
  <header>
    <h1>üèà Gridiron Vault Pro</h1>
    <p class="tagline">Professional Football Card Collection & Trading Platform</p>
  </header>

  <nav>
    <button onclick="showSection('scan')" data-section="scan">üì∏ Scan Card</button>
    <button onclick="showSection('add')" data-section="add">‚ûï Add Manually</button>
    <button onclick="showSection('collection')" data-section="collection">üì¶ Collection</button>
    <button onclick="showSection('trade')" data-section="trade">üîÅ Trade Hub</button>
  </nav>

  <div id="scan" class="section">
    <div class="scan-container">
      <h2 style="margin-bottom: 20px;">üì∏ Scan Football Card</h2>
      <p style="color: #94a3b8; margin-bottom: 20px;">Upload an image of your card to automatically detect player and estimate value</p>
      
      <div class="file-input-wrapper">
        <label for="fileInput" class="file-input-label">
          üì∑ Choose Card Image
        </label>
        <input type="file" id="fileInput" accept="image/*" onchange="scanCard(event)">
      </div>
      
      <div id="scanStatus" class="scan-status"></div>
    </div>
  </div>

  <div id="add" class="section">
    <div class="add-card-form">
      <h2 style="margin-bottom: 25px;">‚ûï Add Card Manually</h2>
      
      <div class="form-group">
        <label class="form-label">Player Name</label>
        <input type="text" id="playerName" class="form-input" placeholder="e.g., Joe Burrow">
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Team</label>
          <input type="text" id="team" class="form-input" placeholder="e.g., Cincinnati Bengals">
        </div>
        
        <div class="form-group">
          <label class="form-label">Year</label>
          <input type="text" id="year" class="form-input" placeholder="e.g., 2020">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Card Number</label>
          <input type="text" id="cardNumber" class="form-input" placeholder="e.g., #101">
        </div>
        
        <div class="form-group">
          <label class="form-label">PSA Grade</label>
          <select id="psaGrade" class="form-select">
            <option value="10">PSA 10 - GEM-MT</option>
            <option value="9">PSA 9 - MINT</option>
            <option value="8">PSA 8 - NM-MT</option>
            <option value="7">PSA 7 - NM</option>
            <option value="6">PSA 6 - EX-MT</option>
            <option value="5">PSA 5 - EX</option>
            <option value="4">PSA 4 - VG-EX</option>
            <option value="3">PSA 3 - VG</option>
            <option value="2">PSA 2 - GOOD</option>
            <option value="1">PSA 1 - PR</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Estimated Value ($)</label>
        <input type="number" id="cardValue" class="form-input" placeholder="0.00" step="0.01">
      </div>
      
      <button onclick="addCardManually()" class="btn btn-primary" style="width: 100%; padding: 15px; font-size: 1.1rem;">
        ‚ûï Add to Collection
      </button>
    </div>
  </div>

  <div id="collection" class="section">
    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-label">Total Cards</div>
        <div class="stat-value" id="totalCards">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Collection Value</div>
        <div class="stat-value" id="totalValue">$0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Average Grade</div>
        <div class="stat-value" id="avgGrade">-</div>
      </div>
    </div>
    
    <h2 style="margin-bottom: 20px;">üì¶ Your Collection</h2>
    <div id="collectionList" class="cards-grid"></div>
  </div>

  <div id="trade" class="section">
    <div class="trade-section">
      <div class="trade-header">
        <span class="trade-participant">You (Evan)</span>
        <span class="trade-arrow">‚Üî</span>
        <span class="trade-participant">Alex</span>
      </div>
      
      <div id="tradeRequests"></div>
    </div>
    
    <h3 style="margin-bottom: 15px;">Your Tradeable Cards</h3>
    <div id="tradeCards" class="cards-grid"></div>
  </div>
</div>

<script>
var PSA_GRADES = {
  10: { label: 'GEM-MT 10', class: 'grade-10' },
  9: { label: 'MINT 9', class: 'grade-9' },
  8: { label: 'NM-MT 8', class: 'grade-8' },
  7: { label: 'NM 7', class: '' },
  6: { label: 'EX-MT 6', class: '' },
  5: { label: 'EX 5', class: '' },
  4: { label: 'VG-EX 4', class: '' },
  3: { label: 'VG 3', class: '' },
  2: { label: 'GOOD 2', class: '' },
  1: { label: 'PR 1', class: '' }
};

var users = [
  { id: 1, name: "Evan" },
  { id: 2, name: "Alex" }
];

var cards = [];
var trades = [];

function init() {
  cards = window.cardsData || [];
  trades = window.tradesData || [];
  showSection('scan');
  render();
}

function showSection(sectionId) {
  var sections = document.querySelectorAll('.section');
  for (var i = 0; i < sections.length; i++) {
    sections[i].classList.remove('active');
  }
  
  var buttons = document.querySelectorAll('nav button');
  for (var j = 0; j < buttons.length; j++) {
    buttons[j].classList.remove('active');
  }
  
  document.getElementById(sectionId).classList.add('active');
  document.querySelector('[data-section="' + sectionId + '"]').classList.add('active');
  
  render();
}

function scanCard(event) {
  var file = event.target.files[0];
  if (!file) return;
  
  var scanStatus = document.getElementById('scanStatus');
  scanStatus.innerHTML = 'üîç Scanning card... <span class="spinner"></span>';
  
  Tesseract.recognize(file, 'eng', {
    logger: function(m) {
      if (m.status === 'recognizing text') {
        scanStatus.innerHTML = 'üîç Processing... ' + Math.round(m.progress * 100) + '% <span class="spinner"></span>';
      }
    }
  }).then(function(result) {
    var text = result.data.text;
    scanStatus.innerHTML = 'üîç Identifying player... <span class="spinner"></span>';
    
    detectPlayer(text).then(function(detectedPlayer) {
      scanStatus.innerHTML = 'üîç Looking up team info... <span class="spinner"></span>';
      
      detectTeam(text, detectedPlayer).then(function(team) {
        var estimatedValue = estimateValue(text);
        var psaGrade = detectGrade(text);
        
        var card = {
          id: Date.now(),
          player: detectedPlayer,
          team: team,
          year: detectYear(text),
          cardNumber: detectCardNumber(text),
          owner: 1,
          value: estimatedValue,
          psaGrade: psaGrade
        };
        
        cards.push(card);
        save();
        
        scanStatus.innerHTML = '‚úÖ Card added! Detected: <strong>' + detectedPlayer + '</strong> (' + team + ') - PSA ' + psaGrade + ' - $' + estimatedValue;
        
        setTimeout(function() {
          showSection('collection');
        }, 2500);
      });
    });
  }).catch(function(err) {
    scanStatus.innerHTML = '‚ùå Scan failed. Please try again or add manually.';
    console.error(err);
  });
}

function detectPlayer(text) {
  return new Promise(function(resolve) {
    var words = text.split(/\s+/);
    var capitalizedWords = [];
    for (var i = 0; i < words.length; i++) {
      if (/^[A-Z][a-z]+/.test(words[i])) {
        capitalizedWords.push(words[i]);
      }
    }
    
    var checkIndex = 0;
    function checkNextName() {
      if (checkIndex >= capitalizedWords.length - 1) {
        checkFamousNames();
        return;
      }
      
      var potentialName = capitalizedWords[checkIndex] + ' ' + capitalizedWords[checkIndex + 1];
      checkIndex++;
      
      verifyNFLPlayer(potentialName).then(function(isPlayer) {
        if (isPlayer) {
          resolve(isPlayer);
        } else {
          checkNextName();
        }
      });
    }
    
    function checkFamousNames() {
      var famousLastNames = [
        'Brady', 'Manning', 'Montana', 'Rice', 'Brown', 'Smith', 'Johnson',
        'Mahomes', 'Allen', 'Burrow', 'Jackson', 'Rodgers', 'Brees',
        'Favre', 'Elway', 'Aikman', 'Young', 'Marino', 'Unitas',
        'Sanders', 'Emmitt', 'Payton', 'Tomlinson', 'Peterson',
        'Moss', 'Owens', 'Fitzgerald', 'Megatron', 'Gronkowski'
      ];
      
      var wordIndex = 0;
      function checkNextWord() {
        if (wordIndex >= capitalizedWords.length) {
          resolve('Unknown Player');
          return;
        }
        
        var word = capitalizedWords[wordIndex];
        wordIndex++;
        
        if (famousLastNames.indexOf(word) !== -1) {
          getFullPlayerName(word).then(function(fullName) {
            if (fullName) {
              resolve(fullName);
            } else {
              checkNextWord();
            }
          });
        } else {
          checkNextWord();
        }
      }
      
      checkNextWord();
    }
    
    checkNextName();
  });
}

function verifyNFLPlayer(name) {
  return fetch("https://api.anthropic.com/v1/messages", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "claude-sonnet-4-20250514",
      max_tokens: 1000,
      messages: [{
        role: "user",
        content: "Is \"" + name + "\" a real NFL football player (past or present)? Respond with ONLY the player's full correct name if yes, or \"NO\" if not a real NFL player. No explanation."
      }]
    })
  })
  .then(function(response) { return response.json(); })
  .then(function(data) {
    var answer = data.content[0].text.trim();
    if (answer !== "NO" && answer.length > 2) {
      return answer;
    }
    return null;
  })
  .catch(function(error) {
    console.error("Player verification error:", error);
    return null;
  });
}

function getFullPlayerName(lastName) {
  return fetch("https://api.anthropic.com/v1/messages", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "claude-sonnet-4-20250514",
      max_tokens: 1000,
      messages: [{
        role: "user",
        content: "What is the full name of the most famous NFL player with last name \"" + lastName + "\"? Respond with ONLY the full name, no explanation."
      }]
    })
  })
  .then(function(response) { return response.json(); })
  .then(function(data) {
    return data.content[0].text.trim();
  })
  .catch(function(error) {
    console.error("Name lookup error:", error);
    return null;
  });
}

function detectTeam(text, player) {
  return new Promise(function(resolve) {
    var nflTeams = [
      'Cardinals', 'Falcons', 'Ravens', 'Bills', 'Panthers', 'Bears', 'Bengals', 'Browns',
      'Cowboys', 'Broncos', 'Lions', 'Packers', 'Texans', 'Colts', 'Jaguars', 'Chiefs',
      'Raiders', 'Chargers', 'Rams', 'Dolphins', 'Vikings', 'Patriots', 'Saints', 'Giants',
      'Jets', 'Eagles', 'Steelers', '49ers', 'Seahawks', 'Buccaneers', 'Titans', 'Commanders'
    ];
    
    for (var i = 0; i < nflTeams.length; i++) {
      if (text.indexOf(nflTeams[i]) !== -1) {
        resolve(getFullTeamName(nflTeams[i]));
        return;
      }
    }
    
    fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        messages: [{
          role: "user",
          content: "What NFL team is/was " + player + " most famous for playing on? Respond with ONLY the full team name (city + mascot), no explanation."
        }]
      })
    })
    .then(function(response) { return response.json(); })
    .then(function(data) {
      resolve(data.content[0].text.trim());
    })
    .catch(function(error) {
      console.error("Team lookup error:", error);
      resolve('Unknown Team');
    });
  });
}

function getFullTeamName(shortName) {
  var teamMap = {
    'Cardinals': 'Arizona Cardinals',
    'Falcons': 'Atlanta Falcons',
    'Ravens': 'Baltimore Ravens',
    'Bills': 'Buffalo Bills',
    'Panthers': 'Carolina Panthers',
    'Bears': 'Chicago Bears',
    'Bengals': 'Cincinnati Bengals',
    'Browns': 'Cleveland Browns',
    'Cowboys': 'Dallas Cowboys',
    'Broncos': 'Denver Broncos',
    'Lions': 'Detroit Lions',
    'Packers': 'Green Bay Packers',
    'Texans': 'Houston Texans',
    'Colts': 'Indianapolis Colts',
    'Jaguars': 'Jacksonville Jaguars',
    'Chiefs': 'Kansas City Chiefs',
    'Raiders': 'Las Vegas Raiders',
    'Chargers': 'Los Angeles Chargers',
    'Rams': 'Los Angeles Rams',
    'Dolphins': 'Miami Dolphins',
    'Vikings': 'Minnesota Vikings',
    'Patriots': 'New England Patriots',
    'Saints': 'New Orleans Saints',
    'Giants': 'New York Giants',
    'Jets': 'New York Jets',
    'Eagles': 'Philadelphia Eagles',
    'Steelers': 'Pittsburgh Steelers',
    '49ers': 'San Francisco 49ers',
    'Seahawks': 'Seattle Seahawks',
    'Buccaneers': 'Tampa Bay Buccaneers',
    'Titans': 'Tennessee Titans',
    'Commanders': 'Washington Commanders'
  };
  
  return teamMap[shortName] || shortName;
}

function detectYear(text) {
  var yearMatch = text.match(/20(1[0-9]|2[0-5])/);
  return yearMatch ? yearMatch[0] : new Date().getFullYear().toString();
}

function detectCardNumber(text) {
  var numMatch = text.match(/#?\d{1,4}/);
  return numMatch ? numMatch[0] : '#' + Math.floor(Math.random() * 500);
}

function detectGrade(text) {
  if (text.indexOf('10') !== -1 || text.indexOf('GEM') !== -1) return 10;
  if (text.indexOf('9') !== -1 || text.indexOf('MINT') !== -1) return 9;
  if (text.indexOf('8') !== -1) return 8;
  return 7 + Math.floor(Math.random() * 3);
}

function estimateValue(text) {
  var baseValue = 25 + Math.floor(Math.random() * 200);
  return baseValue;
}

function addCardManually() {
  var player = document.getElementById('playerName').value.trim();
  var team = document.getElementById('team').value.trim();
  var year = document.getElementById('year').value.trim();
  var cardNumber = document.getElementById('cardNumber').value.trim();
  var psaGrade = parseInt(document.getElementById('psaGrade').value);
  var value = parseFloat(document.getElementById('cardValue').value) || 0;
  
  if (!player) {
    showNotification('‚ö†Ô∏è Please enter a player name', '#f59e0b');
    return;
  }
  
  var card = {
    id: Date.now(),
    player: player,
    team: team || 'Unknown Team',
    year: year || new Date().getFullYear().toString(),
    cardNumber: cardNumber || '#' + Math.floor(Math.random() * 500),
    owner: 1,
    value: value,
    psaGrade: psaGrade
  };
  
  cards.push(card);
  save();
  
  document.getElementById('playerName').value = '';
  document.getElementById('team').value = '';
  document.getElementById('year').value = '';
  document.getElementById('cardNumber').value = '';
  document.getElementById('cardValue').value = '';
  
  showNotification('‚úÖ Card added to collection!');
  showSection('collection');
}

function offerTrade(cardId) {
  var myCard = null;
  for (var i = 0; i < cards.length; i++) {
    if (cards[i].id === cardId) {
      myCard = cards[i];
      break;
    }
  }
  
  var theirCards = [];
  for (var j = 0; j < cards.length; j++) {
    if (cards[j].owner === 2) {
      theirCards.push(cards[j]);
    }
  }
  
  if (theirCards.length === 0) {
    showNotification('‚ö†Ô∏è No cards available to trade', '#f59e0b');
    return;
  }
  
  var targetCard = theirCards[Math.floor(Math.random() * theirCards.length)];
  
  trades.push({
    id: Date.now(),
    offered: cardId,
    requested: targetCard.id,
    status: "pending",
    fromUser: 1,
    toUser: 2
  });
  
  save();
  render();
  showNotification('üì§ Trade offer sent!');
}

function acceptTrade(tradeId) {
  var trade = null;
  for (var i = 0; i < trades.length; i++) {
    if (trades[i].id === tradeId) {
      trade = trades[i];
      break;
    }
  }
  if (!trade) return;
  
  var cardA = null;
  var cardB = null;
  for (var j = 0; j < cards.length; j++) {
    if (cards[j].id === trade.offered) {
      cardA = cards[j];
    }
    if (cards[j].id === trade.requested) {
      cardB = cards[j];
    }
  }
  
  var temp = cardA.owner;
  cardA.owner = cardB.owner;
  cardB.owner = temp;
  
  trade.status = "accepted";
  save();
  render();
  showNotification('‚úÖ Trade completed successfully!');
}

function deleteCard(cardId) {
  if (confirm('Are you sure you want to delete this card?')) {
    var newCards = [];
    for (var i = 0; i < cards.length; i++) {
      if (cards[i].id !== cardId) {
        newCards.push(cards[i]);
      }
    }
    cards = newCards;
    save();
    render();
    showNotification('üóëÔ∏è Card removed from collection');
  }
}

function render() {
  renderCollection();
  renderTrade();
  renderStats();
}

function renderStats() {
  var myCards = [];
  for (var i = 0; i < cards.length; i++) {
    if (cards[i].owner === 1) {
      myCards.push(cards[i]);
    }
  }
  
  var totalValue = 0;
  for (var j = 0; j < myCards.length; j++) {
    totalValue += myCards[j].value;
  }
  
  var avgGrade = '-';
  if (myCards.length > 0) {
    var gradeSum = 0;
    for (var k = 0; k < myCards.length; k++) {
      gradeSum += myCards[k].psaGrade;
    }
    avgGrade = (gradeSum / myCards.length).toFixed(1);
  }
  
  document.getElementById('totalCards').textContent = myCards.length;
  document.getElementById('totalValue').textContent = ' + totalValue.toFixed(2);
  document.getElementById('avgGrade').textContent = avgGrade;
}

function renderCollection() {
  var list = document.getElementById('collectionList');
  var myCards = [];
  for (var i = 0; i < cards.length; i++) {
    if (cards[i].owner === 1) {
      myCards.push(cards[i]);
    }
  }
  
  if (myCards.length === 0) {
    list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì¶</div><h3>No cards in your collection yet</h3><p>Scan a card or add one manually to get started!</p></div>';
    return;
  }
  
  var html = '';
  for (var j = 0; j < myCards.length; j++) {
    var c = myCards[j];
    var gradeInfo = PSA_GRADES[c.psaGrade];
    html += '<div class="card">';
    html += '<div class="card-header">';
    html += '<div>';
    html += '<div class="player-name">' + c.player + '</div>';
    html += '<div class="card-details">' + c.team + '<br>' + c.year + ' ‚Ä¢ ' + c.cardNumber + '</div>';
    html += '</div>';
    html += '<div class="psa-badge ' + gradeInfo.class + '">PSA ' + c.psaGrade + '</div>';
    html += '</div>';
    html += '<div class="card-footer">';
    html += '<div class="card-value"> + c.value.toFixed(2) + '</div>';
    html += '<button onclick="deleteCard(' + c.id + ')" class="btn btn-danger">Delete</button>';
    html += '</div>';
    html += '</div>';
  }
  list.innerHTML = html;
}

function renderTrade() {
  var tradeCardsDiv = document.getElementById('tradeCards');
  var tradeRequestsDiv = document.getElementById('tradeRequests');
  
  var myCards = [];
  for (var i = 0; i < cards.length; i++) {
    if (cards[i].owner === 1) {
      myCards.push(cards[i]);
    }
  }
  
  if (myCards.length === 0) {
    tradeCardsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üÉè</div><p>Add cards to your collection first to start trading</p></div>';
  } else {
    var html = '';
    for (var j = 0; j < myCards.length; j++) {
      var c = myCards[j];
      var gradeInfo = PSA_GRADES[c.psaGrade];
      html += '<div class="card">';
      html += '<div class="card-header">';
      html += '<div>';
      html += '<div class="player-name">' + c.player + '</div>';
      html += '<div class="card-details">' + c.team + ' ‚Ä¢ ' + c.year + '</div>';
      html += '</div>';
      html += '<div class="psa-badge ' + gradeInfo.class + '">PSA ' + c.psaGrade + '</div>';
      html += '</div>';
      html += '<div class="card-footer">';
      html += '<div class="card-value"> + c.value.toFixed(2) + '</div>';
      html += '<button onclick="offerTrade(' + c.id + ')" class="btn btn-primary">Offer Trade</button>';
      html += '</div>';
      html += '</div>';
    }
    tradeCardsDiv.innerHTML = html;
  }
  
  var pendingTrades = [];
  for (var k = 0; k < trades.length; k++) {
    if (trades[k].status === 'pending') {
      pendingTrades.push(trades[k]);
    }
  }
  
  if (pendingTrades.length === 0) {
    tradeRequestsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No pending trade requests</p></div>';
  } else {
    var tradeHtml = '';
    for (var m = 0; m < pendingTrades.length; m++) {
      var t = pendingTrades[m];
      var offeredCard = null;
      var requestedCard = null;
      
      for (var n = 0; n < cards.length; n++) {
        if (cards[n].id === t.offered) {
          offeredCard = cards[n];
        }
        if (cards[n].id === t.requested) {
          requestedCard = cards[n];
        }
      }
      
      tradeHtml += '<div class="trade-request">';
      tradeHtml += '<div class="trade-info">';
      tradeHtml += '<strong>üì§ Offering:</strong> ' + offeredCard.player + ' (PSA ' + offeredCard.psaGrade + ') -  + offeredCard.value + '<br>';
      tradeHtml += '<strong>üì• Requesting:</strong> ' + requestedCard.player + ' (PSA ' + requestedCard.psaGrade + ') -  + requestedCard.value;
      tradeHtml += '</div>';
      tradeHtml += '<button onclick="acceptTrade(' + t.id + ')" class="btn btn-success">Accept Trade</button>';
      tradeHtml += '</div>';
    }
    tradeRequestsDiv.innerHTML = tradeHtml;
  }
}

function save() {
  window.cardsData = cards;
  window.tradesData = trades;
}

function showNotification(message, color) {
  color = color || '#10b981';
  var notif = document.createElement('div');
  notif.className = 'notification';
  notif.style.background = color;
  notif.textContent = message;
  document.body.appendChild(notif);
  
  setTimeout(function() {
    notif.remove();
  }, 3000);
}

init();
</script>

</body>
</html>
